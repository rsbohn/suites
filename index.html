<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plague of Frogs</title>
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=EB+Garamond:wght@600&display=swap" rel="stylesheet">
  <style>
    :root {
      --storm: #0f1b2c;
      --storm-glow: #24344a;
      --swamp: #0b2b28;
      --pond: #103c34;
      --lilypad: #58b35a;
      --lilypad-edge: #82d37f;
      --frog: #9df569;
      --frog-dark: #5a9c47;
      --accent: #c1ff72;
      --ink: #e7f4ff;
      --muted: #9bb5c7;
      --glass: rgba(15, 27, 44, 0.6);
      --glass-bright: rgba(255, 255, 255, 0.06);
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Space Grotesk", "EB Garamond", system-ui, sans-serif;
      background:
        radial-gradient(circle at 20% 20%, rgba(193,255,114,0.12), transparent 35%),
        radial-gradient(circle at 80% 10%, rgba(93,208,255,0.16), transparent 30%),
        linear-gradient(180deg, #08111d 0%, #0b1a29 40%, #061014 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--ink);
    }

    .scene {
      position: relative;
      width: min(90vw, 960px);
      height: min(70vh, 520px);
      background:
        radial-gradient(circle at 50% -10%, rgba(193,255,114,0.15), transparent 40%),
        linear-gradient(180deg, #0f1b2c 0%, #0f1b2c 40%, #0c1f26 58%, #071516 100%);
      border-radius: 20px;
      overflow: hidden;
      box-shadow:
        0 24px 60px rgba(0,0,0,0.25),
        inset 0 0 0 1px rgba(255,255,255,0.05);
      backdrop-filter: blur(4px);
    }

    .storm-texture {
      position: absolute;
      inset: 0;
      background-image:
        radial-gradient(circle at 20% 10%, rgba(193,255,114,0.08) 0 22%, transparent 25%),
        radial-gradient(circle at 70% 0%, rgba(93,208,255,0.12) 0 18%, transparent 22%),
        repeating-linear-gradient(115deg, rgba(255,255,255,0.05) 0 1px, transparent 1px 8px);
      opacity: 0.9;
      pointer-events: none;
    }

    .frog-rain {
      position: absolute;
      inset: 0;
      overflow: hidden;
      pointer-events: none;
      z-index: 1;
    }

    .frog-drop {
      position: absolute;
      left: var(--x);
      top: -10%;
      font-size: var(--s, 22px);
      filter: drop-shadow(0 6px 8px rgba(0,0,0,0.45));
      animation: fall var(--t, 11s) linear infinite;
      animation-delay: var(--d, 0s);
      transform: translate3d(0, -10%, 0) rotate(var(--r, 8deg));
    }

    @keyframes fall {
      from { transform: translate3d(0, -12%, 0) rotate(6deg); }
      to { transform: translate3d(0, 115%, 0) rotate(-8deg); }
    }

    .swamp {
      position: absolute;
      inset: 46% 0 0 0;
      background:
        radial-gradient(ellipse at 30% 30%, rgba(88,179,90,0.18) 0 22%, transparent 26%),
        radial-gradient(ellipse at 60% 55%, rgba(31,209,165,0.12) 0 18%, transparent 24%),
        linear-gradient(180deg, #0b2b28 0%, #0b2b28 50%, #071410 100%);
      border-top: 1px solid rgba(255,255,255,0.06);
      overflow: hidden;
    }

    .ripples {
      position: absolute;
      inset: 0;
      background: repeating-radial-gradient(circle at 50% 30%, rgba(255,255,255,0.06) 0 2px, transparent 2px 16px);
      opacity: 0.2;
      filter: blur(0.4px);
      animation: drift 12s ease-in-out infinite alternate;
    }

    @keyframes drift {
      from { transform: translateX(-3px) scale(1); }
      to { transform: translateX(8px) scale(1.02); }
    }

    .lilypad {
      position: absolute;
      left: 50%;
      bottom: 14%;
      width: 220px;
      height: 110px;
      transform: translateX(-50%);
      background: radial-gradient(ellipse at 50% 60%, var(--lilypad-edge) 0 50%, var(--lilypad) 60% 100%);
      border-radius: 60% 70% 70% 60%;
      box-shadow:
        0 20px 30px rgba(0,0,0,0.32),
        inset 0 0 0 1px rgba(255,255,255,0.18);
      animation: bob 4s ease-in-out infinite;
      z-index: 2;
    }

    @keyframes bob {
      0% { transform: translate(-50%, 0) rotate(-1deg); }
      50% { transform: translate(-50%, -6px) rotate(1deg); }
      100% { transform: translate(-50%, 0) rotate(-1deg); }
    }

    .frog-throne {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      animation: jitter 3s ease-in-out infinite;
    }

    @keyframes jitter {
      0% { transform: translateY(0); }
      40% { transform: translateY(-4px); }
      100% { transform: translateY(0); }
    }

    .frog {
      position: relative;
      width: 120px;
      height: 82px;
      background: linear-gradient(180deg, var(--frog) 0%, var(--frog-dark) 100%);
      border-radius: 60% 60% 50% 50%;
      box-shadow: 0 16px 26px rgba(0,0,0,0.32);
    }

    .frog::before,
    .frog::after {
      content: "";
      position: absolute;
      top: -18px;
      width: 34px;
      height: 34px;
      background: radial-gradient(circle at 50% 40%, #fff 0 40%, #1b2a1b 55%);
      border-radius: 50%;
      box-shadow: 0 8px 12px rgba(0,0,0,0.35);
    }

    .frog::before { left: 20px; }
    .frog::after { right: 20px; }

    .frog .mouth {
      position: absolute;
      left: 22%;
      right: 22%;
      bottom: 18px;
      height: 10px;
      border-radius: 0 0 40% 40%;
      background: radial-gradient(ellipse at center, #0e1c11 0 50%, transparent 80%);
      box-shadow: inset 0 -4px 0 rgba(0,0,0,0.14);
    }

    .frog .spots {
      position: absolute;
      inset: 16px;
      background:
        radial-gradient(circle at 30% 40%, rgba(9,92,46,0.4) 0 16%, transparent 18%),
        radial-gradient(circle at 70% 60%, rgba(9,92,46,0.4) 0 12%, transparent 16%),
        radial-gradient(circle at 45% 70%, rgba(9,92,46,0.3) 0 10%, transparent 14%);
      filter: blur(0.2px);
    }

    .proclamation {
      position: absolute;
      top: 16px;
      left: 16px;
      background: rgba(193,255,114,0.12);
      border: 1px solid rgba(193,255,114,0.5);
      color: var(--ink);
      padding: 12px 14px;
      border-radius: 14px;
      box-shadow: 0 10px 24px rgba(0,0,0,0.2);
      backdrop-filter: blur(8px);
      max-width: 280px;
      z-index: 2;
    }

    .proclamation .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.08);
      font-weight: 700;
      letter-spacing: 0.02em;
      text-transform: uppercase;
      border: 1px solid rgba(255,255,255,0.08);
    }

    .proclamation p {
      margin: 10px 0 0;
      font-size: 14px;
      color: var(--muted);
    }

    .label {
      position: absolute;
      right: 18px;
      bottom: 18px;
      background: var(--glass);
      padding: 12px 16px;
      border-radius: 12px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.24);
      display: flex;
      gap: 10px;
      align-items: center;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.08);
      z-index: 3;
    }

    .label strong { display: block; font-size: 15px; }
    .label small { color: var(--muted); }
    .status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 0 6px rgba(193,255,114,0.16);
    }

    .banner {
      position: absolute;
      top: 18px;
      right: 18px;
      background: rgba(255,255,255,0.08);
      color: var(--ink);
      padding: 10px 14px;
      border-radius: 12px;
      font-size: 13px;
      letter-spacing: 0.01em;
      border: 1px solid rgba(255,255,255,0.1);
      backdrop-filter: blur(6px);
      z-index: 2;
    }

    .banner code { color: var(--accent); }

    .info-panel {
      position: absolute;
      left: 18px;
      bottom: 18px;
      width: min(360px, 88vw);
      background: var(--glass);
      border-radius: 16px;
      box-shadow: 0 12px 28px rgba(0,0,0,0.26);
      backdrop-filter: blur(12px);
      font-size: 14px;
      overflow: hidden;
      max-height: calc(100% - 36px);
      display: flex;
      flex-direction: column;
      z-index: 3;
      border: 1px solid rgba(255,255,255,0.08);
    }

    .panel-controls {
      display: flex;
      justify-content: flex-end;
      padding: 6px 10px 0;
      gap: 6px;
    }

    .tabs {
      display: flex;
      flex-wrap: nowrap;
      gap: 4px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      padding: 12px 10px 8px;
    }

    .tab {
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.08);
      padding: 10px 0;
      font-weight: 700;
      color: var(--ink);
      cursor: pointer;
      flex: 1;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      border-radius: 10px;
    }

    .tab .icon { margin-right: 6px; }
    .tab .tab-label { display: inline; }

    .tab.active {
      background: rgba(193,255,114,0.12);
    }

    .card {
      padding: 12px 14px;
      min-height: 150px;
      flex: 1;
      overflow-y: auto;
      color: var(--ink);
      background: rgba(255,255,255,0.02);
    }

    .board header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
      font-weight: 700;
      color: var(--ink);
    }

    .board small {
      color: var(--muted);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.02em;
      font-size: 12px;
    }

    .messages {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .message {
      display: grid;
      grid-template-columns: auto 1fr;
      column-gap: 10px;
      row-gap: 2px;
      align-items: center;
    }

    .message .author {
      font-weight: 700;
      color: var(--accent);
    }

    .message .text {
      grid-column: 1 / -1;
      color: var(--ink);
    }

    .message .timestamp {
      color: var(--muted);
      font-size: 12px;
    }

    .stack {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .item-title {
      font-weight: 700;
      color: var(--ink);
    }

    .muted {
      color: var(--muted);
      font-size: 13px;
    }

    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* Icon view (collapsed) */
    .info-panel.icon-view {
      width: 74px;
      max-height: calc(100% - 36px);
    }
    .info-panel.icon-view .panel-controls { padding: 6px 6px 0; }
    .info-panel.icon-view .tabs {
      display: flex;
      flex-direction: column;
      border-bottom: none;
      gap: 6px;
      padding: 8px 6px 10px;
    }
    .info-panel.icon-view .tab {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 12px;
      padding: 10px 0;
      font-size: 16px;
      text-align: center;
      flex: none;
    }
    .info-panel.icon-view .tab.active {
      background: rgba(0,0,0,0.08);
    }
    .info-panel.icon-view .tab .tab-label { display: none; }
    .info-panel.icon-view .tab .icon { margin: 0; }
    .info-panel.icon-view .card { display: none; }
  </style>
</head>
<body>
  <div class="scene">
    <div class="storm-texture"></div>
    <div class="frog-rain" aria-hidden="true">
      <span class="frog-drop" style="--x: 4%; --d: 0s; --t: 11s;">üê∏</span>
      <span class="frog-drop" style="--x: 12%; --d: 1.2s; --t: 10s; --s: 24px;">üê∏</span>
      <span class="frog-drop" style="--x: 22%; --d: 0.6s; --t: 12s; --s: 20px;">üê∏</span>
      <span class="frog-drop" style="--x: 32%; --d: 1.8s; --t: 9s;">üê∏</span>
      <span class="frog-drop" style="--x: 42%; --d: 0.4s; --t: 13s; --s: 26px;">üê∏</span>
      <span class="frog-drop" style="--x: 52%; --d: 2.1s; --t: 10s;">üê∏</span>
      <span class="frog-drop" style="--x: 62%; --d: 0.9s; --t: 11s; --s: 28px;">üê∏</span>
      <span class="frog-drop" style="--x: 70%; --d: 1.4s; --t: 12s;">üê∏</span>
      <span class="frog-drop" style="--x: 78%; --d: 0.3s; --t: 9s;">üê∏</span>
      <span class="frog-drop" style="--x: 86%; --d: 1.7s; --t: 10s; --s: 24px;">üê∏</span>
      <span class="frog-drop" style="--x: 94%; --d: 0.8s; --t: 13s;">üê∏</span>
    </div>
    <div class="proclamation" aria-live="polite">
      <div class="badge">‚ö†Ô∏è Plague of Frogs</div>
      <p>Croak advisory in effect. All dispatches route through the marsh.</p>
    </div>
    <div class="banner" id="banner">Forecast: ‚Ä¶</div>
    <div class="swamp" aria-hidden="true">
      <div class="ripples"></div>
      <div class="lilypad">
        <div class="frog-throne" aria-label="Frog regent presiding over the plague">
          <div class="frog">
            <div class="spots"></div>
            <div class="mouth"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="label" id="plant-label">
      <div class="status-dot" aria-hidden="true"></div>
      <div>
        <strong id="plant-name">Awaiting frog herald...</strong>
        <small id="plant-desc">Summoning amphibian dossier.</small>
      </div>
    </div>
    <div class="info-panel">
      <div class="tabs">
        <button class="tab active" data-tab="messages-tab"><span class="icon" aria-hidden="true">üìã</span><span class="tab-label">Marsh Board</span></button>
        <button class="tab" data-tab="weather-tab"><span class="icon" aria-hidden="true">‚òÅÔ∏è</span><span class="tab-label">Sky Omen</span></button>
        <button class="tab" data-tab="objects-tab"><span class="icon" aria-hidden="true">üì¶</span><span class="tab-label">Flotsam</span></button>
        <button class="tab" data-tab="creatures-tab"><span class="icon" aria-hidden="true">üêæ</span><span class="tab-label">Arrivals</span></button>
      </div>
      <div class="card">
        <section class="tab-content active" id="messages-tab" aria-live="polite" aria-label="Central message board, read-only">
          <header>
            <div>Board: Swamp Central</div>
            <small>Read-only</small>
          </header>
          <ul class="messages" id="messages">
            <li class="message">Loading messages...</li>
          </ul>
        </section>
        <section class="tab-content" id="weather-tab" aria-live="polite">
          <header style="display:flex;justify-content:space-between;align-items:center;">
            <div class="item-title">Weather</div>
            <small id="weather-date" class="muted">Loading...</small>
          </header>
          <div id="weather-body" class="muted">Fetching weather...</div>
        </section>
        <section class="tab-content" id="objects-tab">
          <div class="item-title">Flotsam in the reeds</div>
          <ul class="stack" id="objects-list">
            <li class="muted">Loading objects...</li>
          </ul>
        </section>
        <section class="tab-content" id="creatures-tab">
          <div class="item-title">Amphibious visitors</div>
          <ul class="stack" id="creatures-list">
            <li class="muted">Loading visitors...</li>
          </ul>
        </section>
      </div>
    </div>
  </div>

  <script>
    async function loadPlant() {
      try {
        const response = await fetch('/api/plant');
        if (!response.ok) throw new Error('Request failed');
        const data = await response.json();
        document.getElementById('plant-name').textContent = data.name;
        document.getElementById('plant-desc').textContent = data.description;
      } catch (err) {
        document.getElementById('plant-name').textContent = 'The reeds whisper';
        document.getElementById('plant-desc').textContent = 'Could not summon frog dossier right now.';
      }
    }

    async function loadMessages() {
      const list = document.getElementById('messages');
      try {
        const response = await fetch('/api/messages');
        if (!response.ok) throw new Error('Request failed');
        const data = await response.json();
        const messages = data.messages || [];

        list.innerHTML = '';
        if (messages.length === 0) {
          list.innerHTML = '<li class="message">No croaks broadcast yet.</li>';
          return;
        }

        messages.forEach((msg) => {
          const item = document.createElement('li');
          item.className = 'message';

          const author = document.createElement('span');
          author.className = 'author';
          author.textContent = msg.author;

          const timestamp = document.createElement('span');
          timestamp.className = 'timestamp';
          timestamp.textContent = msg.timestamp;

          const text = document.createElement('span');
          text.className = 'text';
          text.textContent = msg.text;

          item.appendChild(author);
          item.appendChild(timestamp);
          item.appendChild(text);
          list.appendChild(item);
        });
      } catch (err) {
        list.innerHTML = '<li class="message">Could not hear the chorus right now.</li>';
      }
    }

    async function loadWeather() {
      const body = document.getElementById('weather-body');
      const dateEl = document.getElementById('weather-date');
      const banner = document.getElementById('banner');
      try {
        const response = await fetch('/api/weather');
        if (!response.ok) throw new Error('Request failed');
        const data = await response.json();
        const w = data.weather;
        if (!w) throw new Error('No weather');

        dateEl.textContent = w.date;
        body.innerHTML = `
          <div class="item-title">${w.condition}</div>
          <div>${Number(w.temperature_c).toFixed(1)} ¬∞C, ${w.precipitation_chance}% chance of precipitation</div>
          <div class="muted">${w.note || ''}</div>
        `;
        if (banner) {
          banner.textContent = `Forecast: ${w.condition}`;
        }
      } catch (err) {
        dateEl.textContent = '‚Äî';
        body.textContent = 'Skies are silent; no omen retrieved.';
        if (banner) banner.textContent = 'Forecast: withheld by frogs';
      }
    }

    async function loadObjects() {
      const list = document.getElementById('objects-list');
      try {
        const response = await fetch('/api/objects');
        if (!response.ok) throw new Error('Request failed');
        const data = await response.json();
        const objects = data.objects || [];
        list.innerHTML = '';
        if (objects.length === 0) {
          list.innerHTML = '<li class="muted">No flotsam sighted.</li>';
          return;
        }
        objects.slice(0, 5).forEach((obj) => {
          const item = document.createElement('li');
          const title = document.createElement('div');
          title.className = 'item-title';
          title.textContent = obj.name;
          const desc = document.createElement('div');
          desc.className = 'muted';
          desc.textContent = obj.description;
          const loc = document.createElement('div');
          loc.className = 'muted';
          loc.textContent = obj.location ? `Location: ${obj.location}` : '';
          item.appendChild(title);
          item.appendChild(desc);
          if (obj.location) item.appendChild(loc);
          list.appendChild(item);
        });
      } catch (err) {
        list.innerHTML = '<li class="muted">Flotsam log jammed.</li>';
      }
    }

    async function loadCreatures() {
      const list = document.getElementById('creatures-list');
      try {
        const response = await fetch('/api/creatures');
        if (!response.ok) throw new Error('Request failed');
        const data = await response.json();
        const creatures = data.creatures || [];
        list.innerHTML = '';
        if (creatures.length === 0) {
          list.innerHTML = '<li class="muted">No ripples in the pond yet.</li>';
          return;
        }
        creatures.forEach((c) => {
          const item = document.createElement('li');
          const title = document.createElement('div');
          title.className = 'item-title';
          title.textContent = c.name;
          const desc = document.createElement('div');
          desc.className = 'muted';
          desc.textContent = c.description;
          const windowEl = document.createElement('div');
          windowEl.className = 'muted';
          windowEl.textContent = c.visit_window ? `Visits: ${c.visit_window}` : '';
          const note = document.createElement('div');
          note.className = 'muted';
          note.textContent = c.note || '';
          item.appendChild(title);
          item.appendChild(desc);
          if (c.visit_window) item.appendChild(windowEl);
          if (c.note) item.appendChild(note);
          list.appendChild(item);
        });
      } catch (err) {
        list.innerHTML = '<li class="muted">Visitors declined to surface.</li>';
      }
    }

    function setupTabs() {
      const tabs = document.querySelectorAll('.tab');
      const panels = document.querySelectorAll('.tab-content');
      const panel = document.querySelector('.info-panel');
      const ICON_VIEW_DELAY = 10000;
      let iconTimeout = null;

      function setIconView(on) {
        panel.classList.toggle('icon-view', on);
      }

      function scheduleIconView() {
        clearTimeout(iconTimeout);
        iconTimeout = setTimeout(() => setIconView(true), ICON_VIEW_DELAY);
      }

      // Start normal, then auto-collapse after delay.
      setIconView(false);
      scheduleIconView();

      tabs.forEach((tab) => {
        tab.addEventListener('click', () => {
          const targetId = tab.getAttribute('data-tab');
          const isActive = tab.classList.contains('active');

          // If already active and in normal view, collapse to icon view.
          if (isActive && !panel.classList.contains('icon-view')) {
            setIconView(true);
            return;
          }

          tabs.forEach(t => t.classList.toggle('active', t === tab));
          panels.forEach(p => p.classList.toggle('active', p.id === targetId));

          // If collapsed, expand to show the selected tab.
          if (panel.classList.contains('icon-view')) {
            setIconView(false);
          }

          // Re-arm auto-collapse.
          scheduleIconView();
        });
      });
    }

    setupTabs();
    loadPlant();
    loadMessages();
    loadWeather();
    loadObjects();
    loadCreatures();
  </script>
</body>
</html>
